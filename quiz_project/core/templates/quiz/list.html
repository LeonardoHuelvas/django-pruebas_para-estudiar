{% extends "index.html" %} {% block content %}

<h1 class="mb-4">Quices</h1>

<!-- Botones de acción -->
<div class="mb-3 d-flex gap-2 flex-wrap">
    <a href="{% url 'core:quiz_create' %}" class="btn btn-primary">
        <i class="fas fa-plus-circle"></i> Nuevo Quiz
    </a>
    <!-- Si vas a usar desde PDF -->
    <!-- <a href="{% url 'core:quiz_desde_pdf' %}" class="btn btn-success">
        <i class="fas fa-file-upload"></i> Generar desde PDF
    </a> -->


    <!-- Botón que abre el modal -->
    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#modalSimulacro">
        <i class="fas fa-play-circle"></i> Iniciar Simulacro
    </button>
</div>

<hr>

<!-- Tabla de quices -->
<table class="table table-bordered table-hover">
    <thead class="thead-light">
        <tr>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for q in object_list %}
        <tr>
            <td><a href="{% url 'core:quiz_detail' q.id %}">{{ q.nombre }}</a></td>
            <td>{{ q.descripcion|default:"—" }}</td>
            <td>
                <a href="{% url 'core:quiz_update' q.id %}" class="btn btn-sm btn-warning">
                    <i class="fas fa-edit"></i> Editar
                </a>
                <a href="{% url 'core:quiz_delete' q.id %}" class="btn btn-sm btn-danger">
                    <i class="fas fa-trash"></i> Eliminar
                </a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="3" class="text-center">Sin registros</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Modal: Seleccionar Eje y Cantidad -->
<div class="modal fade" id="modalSimulacro" tabindex="-1" role="dialog" aria-labelledby="modalSimulacroLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <form method="get" action="{% url 'core:presentar_quiz' eje_id=0 %}" onsubmit="return redirigirSimulacro(this);">

            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalSimulacroLabel">Iniciar Simulacro</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <div class="form-group">
                        <label for="eje_id">Selecciona un Eje Temático:</label>
                        <select name="eje_id" id="eje_id" class="form-control" required>
                            {% for eje in ejes %}
                            <option value="{{ eje.id }}">{{ eje.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="cantidad">Cantidad de preguntas:</label>
                        <input type="number" name="cantidad" id="cantidad" class="form-control" value="20" min="1" max="100" required>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-play"></i> Iniciar Simulacro
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
<script>
    function redirigirSimulacro(form) {
        const ejeId = form.eje_id.value;
        const cantidad = form.cantidad.value;
        const url = `{% url 'core:presentar_quiz' eje_id=12345 %}`.replace('12345', ejeId) + `?cantidad=${cantidad}`;
        window.location.href = url;
        return false; // evita el submit normal
    }
</script>

{% endblock %}